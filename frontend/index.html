<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diabetes Lifestyle Web App</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

<div class="container mt-5">

    <!-- Title -->
    <div class="text-center mb-4">
        <h1 class="fw-bold">Diabetes Lifestyle Web App</h1>
        <p class="text-muted">Personal health self-assessment tool</p>
    </div>

    <!-- Form -->
    <div class="card shadow mx-auto" style="max-width: 500px;">
        <div class="card-body">
            <h4 class="text-center mb-3">Enter Your Information</h4>

            <form id="patientForm">

                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" id="name" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Age</label>
                    <input type="number" id="age" class="form-control" min="1" max="120" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Weight (kg)</label>
                    <input type="number" id="weight" class="form-control" min="1" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Height (meters)</label>
                    <input type="number" id="height" class="form-control" step="0.01" min="0.5" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Fasting Blood Sugar (mg/dL)</label>
                    <input type="number" id="blood_sugar" class="form-control" min="1" required>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">
                        Submit Assessment
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- Results -->
    <div id="results" class="card shadow mt-4 mx-auto d-none" style="max-width: 600px;">
        <div class="card-body">

            <h4 class="text-center text-success mb-3">Health Assessment</h4>

            <p><strong>Name:</strong> <span id="r-name"></span></p>
            <p><strong>Age:</strong> <span id="r-age"></span></p>

            <hr>

            <h5>Blood Sugar Status</h5>
            <p id="r-sugar-status"></p>
            <p class="text-muted" id="r-sugar-advice"></p>

            <hr>

            <h5>Body Mass Index (BMI)</h5>
            <p><strong>BMI:</strong> <span id="r-bmi"></span></p>
            <p id="r-bmi-status"></p>

            <hr>

            <h5>Age-Based Diabetes Risk</h5>
            <p id="r-age-risk"></p>

        </div>
    </div>

    <!-- Chart -->
    <div id="chartCard" class="card shadow mt-4 mx-auto d-none" style="max-width: 600px;">
        <div class="card-body">
            <h5 class="text-center text-info">Blood Sugar Level (mg/dL)</h5>
            <canvas id="healthChart"></canvas>
        </div>
    </div>

</div>

<script>
let chart;

document.getElementById("patientForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const bloodSugar = Number(document.getElementById("blood_sugar").value);

    const data = {
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        weight: document.getElementById("weight").value,
        height: document.getElementById("height").value,
        blood_sugar: bloodSugar
    };

    fetch("http://localhost:5001/submit-data", {
 
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(result => {

        document.getElementById("results").classList.remove("d-none");
        document.getElementById("chartCard").classList.remove("d-none");

        document.getElementById("r-name").textContent = result.patient.name;
        document.getElementById("r-age").textContent = result.patient.age;

        document.getElementById("r-sugar-status").textContent =
            result.clinical_analysis.blood_sugar_status;

        document.getElementById("r-sugar-advice").textContent =
            result.clinical_analysis.blood_sugar_advice;

        document.getElementById("r-bmi").textContent =
            result.clinical_analysis.bmi;

        document.getElementById("r-bmi-status").textContent =
            result.clinical_analysis.bmi_status;

        document.getElementById("r-age-risk").textContent =
            result.clinical_analysis.age_risk;

        // Graph color based on medical scale
        let color = "green";
        if (bloodSugar < 70 || bloodSugar >= 126) color = "red";
        else if (bloodSugar >= 100) color = "orange";

        const ctx = document.getElementById("healthChart");

        if (chart) chart.destroy();

        chart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Blood Sugar"],
                datasets: [{
                    label: "mg/dL",
                    data: [bloodSugar],
                    backgroundColor: color
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 300
                    }
                }
            }
        });
    })
    .catch(err => {
        alert("Backend connection error");
        console.error(err);
    });
});
</script>

</body>
</html>
